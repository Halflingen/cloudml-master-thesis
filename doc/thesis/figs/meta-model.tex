\begin{figure}
  \begin{center}
      \begin{tikzpicture}[scale=0.6, transform shape]

        \node (UserLibrary) [class] { \textbf{UserLibrary} };

        \node (CloudMLEngine) [class, rectangle split, rectangle split parts=3, below=of UserLibrary] {
                \textbf{CloudMLEngine}
                \nodepart{second}
                \nodepart{third}+build(Acc,Li(Templ))
          };
        \node (AuxNode01) [text width=4cm, below=of CloudMLEngine] {};

        \node (Account) [class, rectangle split, rectangle split parts=2, left=of CloudMLEngine, label=left:*] {
                \textbf{Account}
                \nodepart{second}+name: String
          };
        \node (Credential) [class, below=of Account, label=67.5:1] { \textbf{Credential} };
        \node (Password) [class, rectangle split, rectangle split parts=2, below=of Credential, xshift=-4cm] {
                \textbf{Password}
                \nodepart{second}+identity: String \\ ++credential: String
          };
        \node (KeyPair) [class, rectangle split, rectangle split parts=2, below=of Credential] {
                \textbf{KeyPair}
                \nodepart{second}+public: String
          };

        \node (Connector) [class, right=of CloudMLEngine, label=175:*, label=67.5:1] { \textbf{Connector} };
        \node (AmazonEC2) [class, below=of Connector, xshift=-2cm] { \textbf{AmazonEC2} };
        \node (Rackspace) [class, below=of Connector, xshift=2cm] { \textbf{Rackspace} };

        \node (Instance) [class, rectangle split, rectangle split parts=2, below=of AuxNode01] { 
          \textbf{Instance} 
          \nodepart{second}templateName: String
        };
        \node (RuntimeInstance) [darkclass, below=of Instance, yshift=-1cm, label=67.5:*] { \textbf{RuntimeInstance} };
        \node (RuntimeProp) [darkclass, left=of RuntimeInstance, label=5:*] { \textbf{RuntimeProp} };
        \node (PublicIP) [darkclass, rectangle split, rectangle split parts=2, below=of RuntimeProp, xshift=-2cm] {
                \textbf{PublicIP}
                \nodepart{second}+Value: Address
          };
        \node (PrivateIP) [darkclass, rectangle split, rectangle split parts=2, below=of RuntimeProp, xshift=2cm] {
                \textbf{PrivateIP}
                \nodepart{second}+Value: Address
          };

        \node (Template) [class, rectangle split, rectangle split parts=2, right=of Instance, label=-5:*] {
                \textbf{Template}
                \nodepart{second}+name: String
          };
        \node (Node) [class, rectangle split, rectangle split parts=2, below=of Template, label=67.5:*] {
                \textbf{Node}
                \nodepart{second}+name: String
          };
        \node (Property) [class, below=of Node, label=67.5:*] { \textbf{Property} };
        \node (Location) [class, rectangle split, rectangle split parts=2, below=of Property, yshift=-0.25cm] {
                \textbf{Location}
                \nodepart{second}+value: String
          };
        \node (Disk) [class, rectangle split, rectangle split parts=2, left=of Location] {
                \textbf{Disk}
                \nodepart{second}+min: String
          };
        \node (Core) [class, rectangle split, rectangle split parts=2, left=of Disk] {
                \textbf{Core}
                \nodepart{second}+min: String
          };
        \node (RAM) [class, rectangle split, rectangle split parts=2, left=of Core] {
                \textbf{RAM}
                \nodepart{second}+min: String
          };

        \draw[extend] (Password) -- ++(0, 1.25) -| (Credential);
        \draw[extend] (KeyPair) -- ++(0, 1.25) -| (Credential);

        \draw[extend] (AmazonEC2) -- ++(0, 0.75) -| (Connector);
        \draw[extend] (Rackspace) -- ++(0, 0.75) -| (Connector);

        \draw[extend] (RAM) -- ++(0, 0.9) -| (Property);
        \draw[extend] (Core) -- ++(0, 0.9) -| (Property);
        \draw[extend] (Disk) -- ++(0, 0.9) -| (Property);
        \draw[extend] (Location) -- ++(0, 0.9) -| (Property);

        \draw[extend] (PublicIP) -- ++(0, 0.9) -| (RuntimeProp);
        \draw[extend] (PrivateIP) -- ++(0, 0.9) -| (RuntimeProp);

        \draw[line] (Account) -- ++(0, 1) -| (Connector);

        \draw[aggregate] (UserLibrary) -| (9, -1) -- (9, -5) -| (Template.east);
        \draw[aggregate] (UserLibrary) -| (Account.west);

        \draw[aggregate] (Account) -- (Credential.north);

        \draw[aggregate] (CloudMLEngine.east) -| (Connector.west);

        \draw[aggregate] (Template) -- (Node.north);
        \draw[aggregate] (Node) --  (Property.north);

        \draw[line] (Node.west) -- ++(0, 1) -| (Instance.east);
        \draw[line] (Instance.east) -| ++(0.5, -2) -- ++(0, -2) -| (Property.west);

        \draw[aggregate] (RuntimeInstance.north) -- (Instance);

        \draw[aggregate] (RuntimeInstance) -| (RuntimeProp.east);

    \end{tikzpicture}
  \end{center}
  \caption{Meta model of CloudML.}
  \label{fig:meta-model}
\end{figure}
