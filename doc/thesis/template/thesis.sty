\newcommand{\todo}[1]{\textcolor{red}{#1}}
\newcommand{\note}[1]{\textcolor{PineGreen}{\textbf{#1}}}
\newcommand{\question}[1]{\textcolor{blue}{\textbf{#1}}}

\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}

%% No longer used:
%% http://lenaherrmann.net/2010/05/20/javascript-syntax-highlighting-in-the-latex-listings-package

% http://stackoverflow.com/questions/3282319/correct-way-to-define-macros-etc-ie-in-latex
\ExplSyntaxOn
\newcommand\latinabbrev[1]{
  \peek_meaning:NTF . {% Same as \@ifnextchar
    #1\@}%
  { \peek_catcode:NTF a {% Check whether next char has same catcode as \'a, i.e., is a letter
      #1.\@ }%
    {#1.\@}}}
\ExplSyntaxOff

%Omit final dot from each def.
\def\wrt{\latinabbrev{w.r.t}}
\def\eg{\emph{\latinabbrev{e.g}}}
\def\etal{\emph{\latinabbrev{et al}} }
\def\etc{\latinabbrev{etc}}
\def\ie{\latinabbrev{i.e}}

\newcounter{iicounter}
\newenvironment{ii}[0]{\setcounter{iicounter}{0}}{}
\newcommand{\iitem}[0]{%
  \addtocounter{iicounter}{1}%
  \emph{(\roman{iicounter})\xspace}}

\newcommand{\iii}[1]{\emph{(\romannumeral #1 )\xspace}}

\newcommand{\citetable}[1]{\textsc{Table.}~\ref{table:#1}}
\newcommand{\citesec}[1]{\textsc{Sec.}~\ref{sec:#1}}
\newcommand{\citechap}[1]{\textsc{Chap.}~\ref{chap:#1}}
\newcommand{\citefig}[1]{\textsc{Fig.}~\ref{fig:#1}}
\newcommand{\citelist}[1]{\textsc{Listing.}~\ref{list:#1}}
\newcommand{\mypar}[1]{\paragraph{#1.}}

\newcommand{\mysection}[2]{\chapter{#2}\label{sec:#1}}
\newcommand{\mychapter}[2]{\chapter{#2}\label{chap:#1}}
\newcommand{\mycaption}[2]{\caption{#2}\label{fig:#1}}

%% Acro definitions

\newcommand{\myacdef}[2]{\acrodef{ac:#1}[#1]{\emph{#2}}}
\newcommand{\myac}[1]{\ac{ac:#1}}

%% http://tex.stackexchange.com/questions/6985/place-quotation-dictum-in-a-box

\definecolor{quotationcolour}{HTML}{F0F0F0}
\definecolor{quotationmarkcolour}{HTML}{1F3F81}

% Double-line for start and end of epigraph.
\newcommand{\epiline}{\hrule \vskip -.2em \hrule}
% Massively humongous opening quotation mark.
\newcommand{\hugequote}{%
  \fontsize{42}{48}\selectfont \color{quotationmarkcolour} \textbf{``}
  \vskip -.5em
}

% Beautify quotations.
\newcommand{\epigraph}[2]{%
  \bigskip
  \begin{flushright}
  \colorbox{quotationcolour}{%
    \parbox{.90\textwidth}{%
    \epiline \vskip 1em {\hugequote} \vskip -.5em
    \parindent 2.2em
    #1\begin{flushright}\textsc{#2}\end{flushright}
    \epiline
    }
  }
  \end{flushright}
  \bigskip
}

\newcommand{\infobox}[1]{
  \bigskip
  \framebox{ 
    \colorbox{quotationcolour}{
      \parbox{.9\textwidth}{
        #1
      }
    }
  }
}

%% http://tex.stackexchange.com/questions/12020/what-is-the-easiest-way-to-draw-3d-cube-with-tikz

\makeatletter
\pgfkeys{/pgf/.cd,
  parallelepiped offset x/.initial=2mm,
  parallelepiped offset y/.initial=2mm
}
\pgfdeclareshape{parallelepiped}
{
  \inheritsavedanchors[from=rectangle] % this is nearly a rectangle
  \inheritanchorborder[from=rectangle]
  \inheritanchor[from=rectangle]{north}
  \inheritanchor[from=rectangle]{north west}
  \inheritanchor[from=rectangle]{north east}
  \inheritanchor[from=rectangle]{center}
  \inheritanchor[from=rectangle]{west}
  \inheritanchor[from=rectangle]{east}
  \inheritanchor[from=rectangle]{mid}
  \inheritanchor[from=rectangle]{mid west}
  \inheritanchor[from=rectangle]{mid east}
  \inheritanchor[from=rectangle]{base}
  \inheritanchor[from=rectangle]{base west}
  \inheritanchor[from=rectangle]{base east}
  \inheritanchor[from=rectangle]{south}
  \inheritanchor[from=rectangle]{south west}
  \inheritanchor[from=rectangle]{south east}
  \backgroundpath{
    % store lower right in xa/ya and upper right in xb/yb
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgfmathsetlength\pgfutil@tempdima{\pgfkeysvalueof{/pgf/parallelepiped offset x}}
    \pgfmathsetlength\pgfutil@tempdimb{\pgfkeysvalueof{/pgf/parallelepiped offset y}}
    \def\ppd@offset{\pgfpoint{\pgfutil@tempdima}{\pgfutil@tempdimb}}
    \pgfpathmoveto{\pgfqpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfqpoint{\pgf@xb}{\pgf@ya}}
    \pgfpathlineto{\pgfqpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfqpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathclose
    \pgfpathmoveto{\pgfqpoint{\pgf@xb}{\pgf@ya}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xb}{\pgf@ya}}{\ppd@offset}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xb}{\pgf@yb}}{\ppd@offset}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xa}{\pgf@yb}}{\ppd@offset}}
    \pgfpathlineto{\pgfqpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathmoveto{\pgfqpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xb}{\pgf@yb}}{\ppd@offset}}
  }
}
\makeatother

% My tikz styles
\tikzstyle{box}=[parallelepiped,draw=black, drop shadow, fill=gray!20, top color=white, bottom color=black!10, minimum width=1.5cm]
\tikzstyle{tcloud}=[cloud, draw, fill=gray!20, top color=white, drop shadow, bottom color=black!10, aspect=2]
\tikzstyle{tdiamond}=[diamond, aspect=2, draw, top color=white, rounded corners, fill=white!40, drop shadow, bottom color=black!10]
\tikzstyle{class}=[rectangle, draw=black, rounded corners, fill=white!40, drop shadow,
  text centered, anchor=north, text=black, text width=3.5cm, top color=white, bottom color=black!10]
\tikzstyle{darkclass}=[rectangle, draw=black, rounded corners, fill=gray, drop shadow,
  text centered, anchor=north, text=white, text width=3.5cm]
\tikzstyle{extend}=[->, >=open triangle 90]
\tikzstyle{arrow}=[->, >=triangle 60]
\tikzstyle{line}=[-]
\tikzstyle{aggregate}=[>-, >=diamond]

\newcommand{\stickman}[1] {
      \node [circle, draw, fill=gray!20, top color=white, bottom color=black!10, minimum width=1cm] 
        (#1) at (0,0) {};
      \path (#1) ++(0, -2) coordinate (groin);
      \path (#1) ++(0, -1) coordinate (armcon);
      \path (groin) ++(.5, -1.25) coordinate (rfoot);
      \path (groin) ++(-.5, -1.25) coordinate (lfoot);
      \path (armcon) ++(1, -.1) coordinate (rhand);
      \path (armcon) ++(-1, -.1) coordinate (lhand);
      \path[draw, thick] (#1) -- (groin);
      \path[draw, thick] (groin) -- (rfoot);
      \path[draw, thick] (groin) -- (lfoot);
      \path[draw, thick] (armcon) -- (rhand);
      \path[draw, thick] (armcon) -- (lhand);
}

\newcounter{reqcounter}
\newcommand{\req}[3]{
  \bigskip
  \refstepcounter{reqcounter} \label{req:#1} $ \leadsto R_{\thereqcounter} $ : \textbf{#2.}#3
}
\newcommand{\citereq}[1]{
  $R_{\ref{req:#1}}$
}
